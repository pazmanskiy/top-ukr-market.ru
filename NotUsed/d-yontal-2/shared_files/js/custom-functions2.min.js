$(function(){KMA.init(),$(window).resize(function(){KMA.modalRefresh()}),KMA.modalRefresh(),$(document).on("click","a[modal]",function(){var t=$("div#"+$(this).attr("modal"));if(t.length)return KMA.modalShow(t),!1}).on("click",".icon-close, .modal, .button-close",function(t){if(t.preventDefault(),t.target!=this)return!1;KMA.modalHide($(this).closest(".modal"))}).on("keydown",function(t){27==t.keyCode&&KMA.modalHide($(".modal:visible:last"))}).on("click",".modal > *",function(t){return t.stopPropagation(),!0}),$("#kmacb-form form").on("submit",function(t){t.preventDefault();var n=$("form:first"),e=n.find("input[name=frompopup]"),a=$(this).serializeArray();$(a).each(function(t,e){try{n.find("[name="+e.name+"]").val(e.value)}catch(t){}}),e.val("1"),n.trigger("submit").trigger("reset")}),$("#kmacb-form-append").length&&$("#kmacb-form form").length&&($("#kmacb-form form").prepend($("#kmacb-form-append").html()),$("#kmacb-form-append").remove()),$("form").append('<input type="hidden" name="jswork" value="1" />'),$("form").append('<input type="hidden" name="frompopup" value="0" />')});var KMA=function(s,t){return s.extend(t,{init:function(){this.setTimezone(),this.initDataCountry(),this.initMethodForm(),this.checkPhoneLen(),this.initAgreement(),this.initTranslate()},modalHide:function(t){t.fadeOut("fast",function(){s(".modal:visible").length||(s("body").removeClass("modal-show"),s(document).trigger("kma.modal-hide"))})},modalRefresh:function(){if(s(".modal:visible:last").length){var t=s(".modal:visible:last .modal-block"),e=parseInt(t.width()),n=parseInt(t.height());s(window).height()>n+20?t.addClass("modal-top").removeClass("margin-t-b").css("margin-top",n/2*-1):t.addClass("margin-t-b").removeClass("modal-top"),s(window).width()>e?t.addClass("modal-left").removeClass("margin-l").css("margin-left",e/2*-1):t.addClass("margin-l").removeClass("modal-left")}},modalShow:function(t){t.fadeIn("fast"),s("body").addClass("modal-show"),s(document).trigger("kma.modal-show"),this.modalRefresh()},initCallback:function(t){try{s("#kmacb > a").on("click",function(t,e){null!=e&&e||s(document).trigger("kma.callbackOperator")}),null!=window.kmacb_manager_class&&s("#kmacb").addClass(window.kmacb_manager_class),null!=window.kmacb_form_selector&&(s("#kmacb > a").attr("kmacb-custom-form",window.kmacb_form_selector),s("#kmacb > a").on("click",function(t,e){t.preventDefault(),t.stopPropagation(),s(window.kmacb_form_selector).trigger("click",[!0])}),s(window.kmacb_form_selector).on("click",function(t,e){null!=e&&e||s(document).trigger("kma.callbackButton")})),setTimeout(function(){s("#kmacb").show()},t)}catch(t){}},setTimezone:function(){var t=(new Date).getTimezoneOffset();s("form").append('<input type="hidden" name="timezone" value="'+t+'" />')},setCountryField:function(t){s("form").append("<input type='hidden' name='country' value='"+t+"' />")},checkAndSetCountryField:function(t){s("select[name=country]").length||s("input[name=country]").length||this.setCountryField(t)},disableCountrySelect:function(t){s("select[name=country]").length&&(s("select[name=country]").attr("disabled","disabled"),this.setCountryField(t))},initComebacker:function(t){try{setTimeout(function(){var e=!0;s(window).on("mouseout",function(t){if(t.pageY-s(window).scrollTop()<1&&e){if(null!=window.customPopupShowed&&!0===window.customPopupShowed)return;e=!1,s(document).trigger("kma.mouseLeave"),s("#kmacb > a").trigger("click",[!0])}})},t)}catch(t){}},phoneMaxLen:25,checkPhoneLen:function(){var n=this;try{null!=window.phone_max_length&&""!=window.phone_max_length&&(n.phoneMaxLen=parseInt(window.phone_max_length))}catch(t){}s(document).on("keypress","input[name=phone]",function(t){var e=new RegExp("[^0-9]*","g");s(this).val().replace(e,"").length>=n.phoneMaxLen&&t.preventDefault()})},validateAndSendForm:function(r,l){var c=this;s(document).on("submit","form",function(){if(!s(this).closest("#kmacb-form").length){if(r&&c.prepareJsonData(s(this)),s("input[name=name]",this).val(s.trim(s("input[name=name]",this).val())),!s("input[name=name]",this).val())return alert(l.validation_name),!1;var t=s("input[name=phone]",this).val(),e=new RegExp("[^0-9]*","g"),n=new RegExp("[^0-9-+ ()]","g"),a=t.replace(e,"");if(-1!=t.search(n))return alert(l.validation_phone1),!1;if(!a||a.length<9)return alert(l.validation_phone2),!1;if(a.length&&a.length>c.phoneMaxLen)return alert(l.validation_phone3),!1;c.showComebackerAlert=!1;try{var o=null==s(this).attr("data-kma-yacounter-id-important")?s(this).attr("data-kma-yacounter-id"):s(this).attr("data-kma-yacounter-id-important"),i=null==s(this).attr("data-kma-yacounter-goal-important")?s(this).attr("data-kma-yacounter-goal"):s(this).attr("data-kma-yacounter-goal-important");null!=o&&null!=i&&(o=o.trim(),i=i.trim(),""!=o&&""!=i&&window["yaCounter"+o.trim()].reachGoal(i))}catch(t){console.log("Exception: Yandex Metrica - yaCounter")}return!0}}),s("a.order-btn").click(function(){return s(this).closest("form").submit(),!1})},prepareJsonData:function(t){var n=t.serializeArray(),a=!1;s(n).each(function(t,e){"address"==e.name&&(a=!0),"name"!=e.name&&"phone"!=e.name&&"address"!=e.name||delete n[t]}),0==a&&t.append("<input type='hidden' name='address' />"),t.find("input[name='address']").val(s.JSON.encode(n))},initVibrate:function(t){setInterval(function(){try{window.navigator&&window.navigator.vibrate?navigator.vibrate([50,30,100,30,100,30,100,30,100,30,100,30,100,30,100,30,100,30,100,30]):navigator.vibrate(0)}catch(t){}},t)},showComebackerAlert:!0,initComebackerAlert:function(e){var n=this;window.onbeforeunload=function(t){if(n.showComebackerAlert){n.showComebackerAlert=!1,s("form").append('<input type="hidden" name="aftercomebacker" value="1" />'),s.get("/index.php",{comebackershow:"1"});try{setTimeout(function(){s.get("/index.php",{comebackeraccept:"1"})},1e3)}catch(t){}return e.comebacker_text}}},showNewsBlogIframe:!0,funcNewsBlogIframe:function(t,e){if(this.showNewsBlogIframe)return this.showNewsBlogIframe=!1,s("body").css({overflow:"hidden",background:"#FFF"}).html('<iframe src="'+e+'" id="comebacker_smi" style="position:fixed;border:none;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:9999999999;"></iframe>'),t.comebacker_text},initNewsBlogIframe:function(t,e,n){var a=this,o=null,i=1e3*parseInt(n);s(document).on("mousemove keydown scroll",function(){clearTimeout(o),o=setTimeout(function(){a.funcNewsBlogIframe(t,e)},i)}),s("body").trigger("mousemove")},initRedirectAfterSomeSeconds:function(t,e){var n=null,a=1e3*parseInt(e);$(document).on("mousemove keydown scroll",function(){clearTimeout(n),n=setTimeout(function(){window.location.href=t},a)})},initDataCountry:function(){var t=this;t.changeDataCountry(window.country),t.changeDataNotCountry(window.country),s(".country_select").change(function(){t.changeDataCountry(s(this).val()),t.changeDataNotCountry(s(this).val())})},eur:["AT","BG","GB","HU","DE","GR","ES","IT","CY","MK","NL","PL","PT","RO","RS","SK","SI","TR","FR","HR","CZ","CH","BE","IL","LV","LT","LU","NO","SE","EE"],sng:["RU","UA","BY","KZ","MD","KG","UZ","AZ","AM","TJ","TM","GE","UZ"],changeDataCountry:function(a){var o=this;s.each(s("[data-kma-country]"),function(){var t=s(this).attr("data-kma-country").split(" ").join("").toUpperCase().split(","),e=s(this).is("[data-kma-class]")?s(this).attr("data-kma-class"):void 0,n=void 0;-1<o.sng.indexOf(a)?n="SNG":-1<o.eur.indexOf(a)&&(n="EUR"),-1<t.indexOf(a)||null!=n&&-1<t.indexOf(n)?null!=e?s(this).addClass(e):s(this).show():null!=e?s(this).removeClass(e):s(this).hide()})},changeDataNotCountry:function(n){var a=this;s.each(s("[data-kma-not-country]"),function(){var t=s(this).attr("data-kma-not-country").split(" ").join("").toUpperCase().split(","),e=void 0;-1<a.sng.indexOf(n)?e="SNG":-1<a.eur.indexOf(n)&&(e="EUR"),-1<t.indexOf(n)||null!=e&&-1<t.indexOf(e)?s(this).hide():s(this).show()})},initAgreement:function(){if(!s("[modal=agreement]").length){var t=s("[modal=polit]:visible:last"),e=t.clone();t.after(e.attr("modal","agreement").text("Пользовательское соглашение")),t.after("<br>")}},ruLangList:["ru","az","be","kk","uk","ka"],initTranslate:function(){var t=s("[modal=agreement]:visible:last"),e=s("[modal=polit]:visible:last");t.length&&(-1<this.ruLangList.indexOf(window.lang)?t.text("Пользовательское соглашение"):t.text("User Agreement")),e.length&&(-1<this.ruLangList.indexOf(window.lang)?e.text("Политика конфиденциальности"):e.text("Privacy Policy"))},initMethodForm:function(){s("form").attr("method","POST")}})}(jQuery,KMA||{});
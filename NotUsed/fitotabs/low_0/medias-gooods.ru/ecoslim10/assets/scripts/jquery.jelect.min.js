/*! jquery.jelect.js v1.0.0 | felixexter | MIT License | https://github.com/CSSSR/jelect/ */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";var t,i,o,n="jelect";e[n]={version:"1.0.0",options:{classes:{autocomplete:n+"_type_autocomplete",containerActive:n+"_state_active",containerDisabled:n+"_state_disabled",currentActive:n+"-current_state_active",optionsActive:n+"-options_state_active",optionActive:n+"-option_state_active",optionDisabled:n+"-option_state_disabled",optionHide:n+"-option_state_hide"},plugins:[]},plugins:{},selectors:{container:".js-"+n,scroller:".js-"+n+"-scroller",input:".js-"+n+"-input",current:".js-"+n+"-current",options:".js-"+n+"-options",option:".js-"+n+"-option",optionValue:".js-"+n+"-option-value"},keyCode:{TAB:9,BACKSPACE:8,ENTER:13,ESC:27,DOWN:40,UP:38,HOME:36,END:35,PAGE_UP:33,PAGE_DOWN:34}},i=function(t){var i=this,o=e[n],s=o.selectors,a=o.options.classes,l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),r=l.find(s.optionValue).text();return l.hasClass(a.optionDisabled)?(console.error("Option {"+t+"} is disabled"),!1):(l.addClass(a.optionActive).siblings(s.option).removeClass(a.optionActive),i.$jelect.val(t).removeClass(a.containerActive).trigger("jelect.change"),i.autocomplete?i.$jelectCurrent.val(t):(i.$jelectCurrent.text(r).attr("data-val",t),i.$jelectInput.val(t).attr("value",t).trigger("change")),void i.trigger("change"))},o=function(){var t=this,i=e[n].selectors,o=[];return t.$jelectOptions.find(i.option).each(function(t,i){var n=e(i);o.push({index:t,value:n.data("val")})}),o},t=function(t,i){var o=e[n],s=o.selectors,a=o.options.classes,l={$jelect:t,$jelectCurrent:t.find(s.current),$jelectOptions:t.find(s.options),$jelectInput:t.find(s.input),autocomplete:t.hasClass(a.autocomplete),options:e.extend(!0,{},o.options,i||{})};e.extend(!0,this,l),this.init()},t.prototype.init=function(){var t=this,o=e[n],s=o.selectors,a=t.options.classes,l=t.$jelectOptions.find(s.option).not("."+a.optionDisabled).data("val");t.trigger("init"),t.values=t.serialize(),t.$jelect.val(l),t.$jelectCurrent.on("click "+n+".clickCurrent",function(){var i,o=e(s.container).filter("."+a.containerActive).not(t.$jelect),n=e(s.options).filter("."+a.optionsActive).not(t.$jelectOptions),l=t.$jelect.find(s.scroller),r=l.scrollTop(),c=t.$jelect.hasClass(a.containerDisabled),p=!t.$jelect.hasClass(a.containerActive)&&!t.$jelectOptions.hasClass(a.optionsActive);return c?!1:(p&&t.trigger("beforeOpen"),o.length&&n.length&&(o.removeClass(a.containerActive),n.removeClass(a.optionsActive)),t.$jelect.toggleClass(a.containerActive),t.$jelectOptions.toggleClass(a.optionsActive),t.$jelect.hasClass(a.containerActive)&&(i=t.$jelectOptions.find("."+a.optionActive),r=l.scrollTop(),l.scrollTop(r+i.position().top)),t.autocomplete&&t.$jelectCurrent.trigger("keyup"),void(p&&(t.$jelectCurrent.trigger("focus"),t.trigger("afterOpen"))))}),t.$jelectOptions.on("click "+n+".changeOption",s.option,function(){var o=e(this),n=o.data("val");return o.hasClass(a.optionDisabled)?!1:(i.call(t,n),void t.$jelectOptions.removeClass(a.optionsActive))}),t.autocomplete&&t.$jelectCurrent.on("keyup",function(i){var n=e(this),l=o.keyCode,r=i.keyCode,c=String.fromCharCode(r),p=/[a-zA-Zа-яА-ЯЁё0-9]/,v=n.val(),u=t.$jelectOptions.find(s.option),d=t.$jelect.find(s.scroller),f=e.grep(t.values,function(e){return-1===e.value.indexOf(v)});(p.test(c)||r===l.BACKSPACE)&&(t.$jelect.hasClass(a.containerActive)||t.$jelectCurrent.trigger("click"),u.removeClass(a.optionHide),e.each(f,function(e,t){var i=t.value;u.filter('[data-val="'+i+'"]').addClass(a.optionHide)}),u.filter(":visible").removeClass(a.optionActive).first().addClass(a.optionActive),d.scrollTop(0))})},t.prototype.trigger=function(t){var i=this;e.each(i.options.plugins||[],function(o,s){s=e[n].plugins[s],s&&s[t]&&s[t]({$jelect:i.$jelect,$jelectCurrent:i.$jelectCurrent,$jelectOptions:i.$jelectOptions,$jelectInput:i.$jelectInput,options:i.options,text:i.text(),val:i.val()})})},t.prototype.text=function(){return this.$jelectCurrent.text().trim()},t.prototype.val=function(){return this.$jelect.val()},t.prototype.setValue=function(e){return"undefined"!=typeof e&&i.call(this,e),this},t.prototype.addValue=function(t,i,o){var s=this,a=e[n],l=a.selectors,r=a.options.classes,c=s.$jelectOptions.find(l.option),p=c.length-1,v=null===o||void 0===o?p+1:o,u=null,d=null;v>c.length?v=p+1:0>v&&(v=0),u=0===v?c.first():v>0&&p>=v?c.eq(v):c.last(),d=u.clone(),d.removeClass(r.optionDisabled).removeClass(r.optionActive).removeClass(r.optionHide).attr("data-val",t).find(l.optionValue).html(i.trim()),p>=v?u.before(d):u.after(d),s.values.push({index:s.values.length,value:t})},t.prototype.serialize=function(){return o.call(this)},t.prototype.disable=function(t){var i=this,o=e[n],s=o.selectors,a=o.options.classes,l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),r=!l.hasClass(a.optionDisabled);if("undefined"!=typeof t){if(r&&(l.addClass(a.optionDisabled),i.$jelectCurrent.data("val")===t)){var c=i.$jelectOptions.find(s.option).not("."+a.optionDisabled).first();i.setValue(c.data("val"))}}else i.$jelect.addClass(a.containerDisabled),i.$jelectInput.attr("disabled",!0);return this},t.prototype.enable=function(t){var i=this,o=e[n],s=o.selectors,a=o.options.classes,l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),r=l.hasClass(a.optionDisabled);return"undefined"!=typeof t&&r?r&&(l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),l.removeClass(a.optionDisabled)):(i.$jelect.removeClass(a.containerDisabled),i.$jelectInput.attr("disabled",!1)),this},e(window.document).on("click "+n+".clickOutside",function(t){var i,o,s=e[n],a=s.selectors,l=e(t.target),r=e(a.options);if(!l.is(a.container)&&!l.closest(a.container).length){if(i=r.closest(a.container).data("jelect"),!i)return;o=i.options.classes,r.hasClass(o.optionsActive)&&(r.removeClass(o.optionsActive).closest(a.container).removeClass(o.containerActive),i.trigger("clickOutside"))}}).on("keydown "+n+".keydown",function(t){var o,s,a,l,r,c,p,v,u,d,f,C,g,h,j,A=e(t.target),$=e[n],b=$.keyCode,m=t.keyCode,y=$.selectors;if(A.is(y.current)){switch(o=A.closest(y.container).data(n),s=o.options.classes,d=A.closest(y.container),f=d.find(y.scroller),C=d.find(y.options),r=C.outerHeight(),g=d.find(y.option).not("."+s.optionHide),h=g.filter("."+s.optionActive),c=d.hasClass(s.containerActive),a=f.scrollTop(),m){case b.TAB:d.removeClass(s.containerActive),C.removeClass(s.optionsActive),i.call(o,o.val());break;case b.ENTER:d.hasClass(s.containerActive)?h.trigger(n+".changeOption"):A.trigger("click"),t.preventDefault();break;case b.ESC:if(!c)return;A.trigger("click"),i.call(o,o.val()),t.preventDefault();break;case b.UP:if(t.preventDefault(),!c)return void A.trigger("click");var D=g.first().is(h);h.removeClass(s.optionActive),j=D?g.last():h.prevAll(":visible").not("."+s.optionDisabled).first(),l=j.position().top,0>l?a+=l:l>a+r&&(a=l);break;case b.DOWN:if(t.preventDefault(),!c)return void A.trigger("click");var O=g.last().is(h);h.removeClass(s.optionActive),j=O?g.first():h.nextAll(":visible").not("."+s.optionDisabled).first(),l=j.position().top,l>=r?a+=l:0>l&&(a=l);break;case b.HOME:if(t.preventDefault(),!c)return;if(h.is(g.first()))return;h.removeClass(s.optionActive),j=g.first(),a=j.position().top;break;case b.END:if(t.preventDefault(),!c)return;if(h.is(g.last()))return;h.removeClass(s.optionActive),j=g.last(),a=j.position().top;break;case b.PAGE_UP:if(t.preventDefault(),!c)return;p=Math.round(r/h.outerHeight()),v=Math.ceil((h.index()+1)/p)-1,u=v*p-p-1,h.removeClass(s.optionActive),0>u&&(u=0),j=0===u&&g.eq(u).hasClass(s.optionDisabled)?g.eq(u).nextAll(":visible").not("."+s.optionDisabled).first():g.eq(u),a+=j.position().top;break;case b.PAGE_DOWN:if(t.preventDefault(),!c)return;p=Math.round(r/h.outerHeight()),v=Math.ceil((h.index()+1)/p)+1,u=v*p-p,h.removeClass(s.optionActive),u>g.length&&(u=g.length-1),j=u===g.length-1?g.eq(u):g.eq(u).nextAll(":visible").not("."+s.optionDisabled).first(),a+=j.position().top}j&&(j.addClass(s.optionActive),f.scrollTop(a))}else A.is(y.option)&&(o=A.closest(y.container).data(n),s=o.options.classes,m===b.ENTER&&A.trigger(n+".changeOption"))}),e.fn[n]=function(i){var o=this,s=arguments;if(void 0===i||"object"==typeof i)return o.each(function(o,s){e.data(s,n)||e.data(s,n,new t(e(s),i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var a;return o.each(function(o,l){var r=e.data(l,n);r instanceof t&&"function"==typeof r[i]&&(a=r[i].apply(r,Array.prototype.slice.call(s,1))),"destroy"===i&&e.data(this,n,null)}),void 0!==a?a:o}}});